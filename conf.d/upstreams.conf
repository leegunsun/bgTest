# NGINX Upstream Configuration for True Blue-Green Deployment
# Container-based networking for zero-downtime deployment

upstream blue {
    server blue-app:3001 max_fails=3 fail_timeout=30s;
    keepalive 32;
    keepalive_requests 100;
    keepalive_timeout 60s;
}

upstream green {
    server green-app:3002 max_fails=3 fail_timeout=30s;
    keepalive 32;
    keepalive_requests 100;
    keepalive_timeout 60s;
}

# Fallback upstream for error handling - both environments
upstream fallback {
    server blue-app:3001 backup;
    server green-app:3002 backup;
    keepalive 16;
}