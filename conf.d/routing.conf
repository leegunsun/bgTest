# Backend Routing Configuration for True Blue-Green Deployment
# Maps the active color to the actual backend upstream group

map $active $backend {
    default   blue;     # Default to blue environment
    blue      blue;     # Blue traffic goes to blue upstream
    green     green;    # Green traffic goes to green upstream
}

# Optional: Canary deployment support
# Uncomment and configure percentages for gradual traffic switching
# split_clients "$remote_addr$request_id" $bucket {
#     5%     "canary";
#     *      "stable";
# }
# 
# map $bucket $canary_backend {
#     canary  green;
#     stable  blue;
# }